#
# otoge_rl_project: .github/workflows/quality.yml
#
# GitHub Actions ワークフロー定義ファイルです。
# 'push' イベント時に自動的に 'uv sync' (依存関係チェック) と
# 'make lint' (コード検査), 'make check-fmt' (整形チェック) を実行します。
#

# ワークフローの名前
name: Code Quality Check

# ワークフローが実行されるタイミング
on:
  push:
    branches:
      - main  # main ブランチへの push
      - develop # develop ブランチへの push
  pull_request:
    branches:
      - main  # main ブランチへの PR

jobs:
  check-quality:
    # 実行環境 (最新の Ubuntu)
    runs-on: ubuntu-latest

    steps:
      # 1. リポジトリのコードをチェックアウト
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Python 3.11 環境をセットアップ
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. uv (高速インストーラ/パッケージマネージャ) をインストール
      - name: Install uv
        run: curl -LsSf https://astral.sh/uv/install.sh | sh
        shell: bash

      # 4. uv を PATH に追加 (インストーラが自動で行うが、明示的に確認)
      - name: Update PATH for uv
        run: echo "$HOME/.cargo/bin" >> $GITHUB_PATH
        shell: bash

      # 5. Makefile を使用して依存関係をインストール (uv sync を実行)
      #    `uv.lock` ファイルとの互換性をチェックします。
      - name: Install dependencies (uv sync)
        run: make install

      # 6. Linter (コードエラー検査) を実行
      - name: Run linter (make lint)
        run: make lint

      # 7. Formatter (コード整形チェック) を実行
      - name: Check formatting (make check-fmt)
        run: make check-fmt
